<ui:composition template="/WEB-INF/templates/masterTemplate.xhtml"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    
   <ui:define name="title">Simple Transaction</ui:define>

   <ui:define name="content">

      <h:body>
         <div class="container-fluid">
           
            <div class="mt-2 py-3 px-3">
               <div class="card justify-content-center" style="width: 200px; height: 70px; border: 0;">
                  <p>
                     <img src="resources/images/coin.png" style="width: 28px; height: 28px; padding-top: -10px;"/>  
                     <b>Balance: </b>
                     <p:spacer width="5" height="5"/>
                     <h:outputText value="#{transaction.senderbalance}" style="font-size: 28px; color: #1565C0;"/>
                  </p>
               </div>
            </div>

            <h:inputHidden id="bindAuth" value="#{transaction.getuserbindAuth()}"/>

            <div class="container d-flex justify-content-center align-items-center my-4">
               <div class="card shadow px-5 py-5 transact-image" style="width: 80%; height: 80%; border-width: 2px; background-color: #B3E5FC;">
               
                     
                  <h:form id="transact">
                     <p:growl id="messages" showDetail="true"/>
                           
                     <div class="card mx-4 mb-3 py-3" style="/*background-color: #29B6F6;*/ background-color: transparent; border: 0;">
                        <div class="py-3">
                           <div>
                              <h:outputLabel for="receiverInput" styleClass="block"><img src="resources/images/receiver.png" style="width: 30px; height: 30px;"/> Receiver</h:outputLabel>
                           </div>
                        
                           <p:inputText icon="pi pi-user" id="receiverInput" class="rounded-pill" value="#{transaction.receiver}" onchange="this.value = this.value.trim()" required="true" requiredMessage="Please input a Receiver!" validatorMessage="Receiver can only contain string and number!" style="text-align:center; width: 50%; height: 50%; padding-top: 10px; padding-bottom: 10px;">
                              <f:validateRegex pattern ="^[a-zA-Z0-9]+$"/>
                           </p:inputText>
                        </div>

                        <div class="py-3">
                           <div>
                              <h:outputLabel for="messageInput" styleClass="block"><img src="resources/images/message.png" style="width: 30px; height: 30px;"/> Transaction Messages</h:outputLabel>
                           </div>
            
                           <p:inputText id="messageInput" class="rounded-pill" value="#{transaction.message}" onchange="this.value = this.value.trim()" required="true" requiredMessage="Please input a Message!" validatorMessage="Message can only contain string!" style="text-align:center; width: 50%; height: 50%; padding-top: 10px; padding-bottom: 10px;">
                              <f:validateRegex pattern ="^[a-zA-Z]+$"/>
                           </p:inputText>
                        </div>

                        <div class="py-3">
                           <div>
                              <h:outputLabel for="amountInput" styleClass="block"><img src="resources/images/amount.png" style="width: 30px; height: 30px;"/> Amount</h:outputLabel>   
                           </div>
                           
                           <p:inputNumber id="amountInput" value="#{transaction.amount}" autocomplete="off" onchange="this.value = this.value.trim()" required="true" requiredMessage="Please input the amount!" minFractionDigits="0" maxFractionDigits="1000000000"/>
                        </div>

                     </div>
                        
                     <div class="mx-3">
                        <p:commandButton disableOnAjax="false" value="Submit" action="#{transaction.validate()}" update="@form" styleClass="submit-button rounded-pill"/>
                     </div>

                     <p:dialog header="Confirm Details" widgetVar="confirmDetails" minHeight="50" width="400" showEffect="fade" modal="true">
                        <div class="container py-3 text-center">
                           <div class="my-2">
                              <p style="font-family: 'Roboto', sans-serif; font-weight: bold;">Receiver:
                                 <p:outputLabel style="font-family: 'Roboto', sans-serif; font-weight: normal;" value="#{transaction.getReceiver()}"/>
                              </p>
                           </div>
                           <div class="my-2">
                              <p style="font-family: 'Roboto', sans-serif; font-weight: bold;">Transaction Message:
                                 <p:outputLabel style="font-family: 'Roboto', sans-serif; font-weight: normal;" value="#{transaction.getMessage()}"/>
                              </p>
                           </div>
                           <div class="my-2">
                              <p style="font-family: 'Roboto', sans-serif; font-weight: bold;">Amount:
                                 <p:outputLabel style="font-family: 'Roboto', sans-serif; font-weight: normal;" value="#{transaction.getAmount()}"/>
                              </p>
                           </div> 
                        </div>

                        <div>
                           <p:commandButton icon="pi pi-check" value="Confirm" onclick="showOption()" styleClass="confirmButton"/>
                        </div>

                     </p:dialog>

                     <p:dialog header="Choose Authentication Method" widgetVar="showTransact" minHeight="50" width="500" showEffect="fade" modal="true">
                        <div id="bindauth" style="display: none;" class="row">
                              
                           <div class="container pt-4">
                              <div class="row text-center align-items-center">
                                 <div class="col-sm">
                                    <p:commandButton id="pushButton" icon="pi pi-send" styleClass="rounded-button ui-button-info my-button" action="#{transaction.route('push')}"/>
                                    <div class="mt-2">
                                          <b>PUSH CROTP</b>
                                    </div>
                                 </div>
               
                                 <div class="col-sm">
                                    <p:commandButton id="qrButton" icon="pi pi-qrcode" styleClass="rounded-button ui-button-info my-button" action="#{transaction.route('qr')}"/>
                                    <div class="mt-2">
                                          <b>QR Code</b>
                                    </div>
                                 </div>
                              </div>
                           </div>

                        </div>
                        
                        <div id="bindnoauth" style="display: none;" class="row">
                           <div class="mt-3" id="method">
                              <p:commandButton icon="pi pi-send" styleClass="rounded-button ui-button-info my-button" action="#{transaction.route('push')}"/>
                              <div class="mt-2">
                                 <b>PUSH CROTP</b>
                              </div>
                           </div>
                           
                           <div class="card py-3 mt-3" style="background-color: #BBDEFB; border: 0;">
                              <p style="font-family: 'Roboto', sans-serif; color:#1E3A8A; padding-top: 10px;">To Use the <b>QR Transaction Authentication method</b>, Please enabled passwordless in your <b>Centagate Console</b>. You can find the guideline in the homepage</p>
                           </div>
                        </div>
                        
                        <div id="nobindnoauth" style="display: none;" class="row">
                           <div class="mt-4">
                              <p style="font-family: 'Roboto', sans-serif; color:#1E3A8A;">You have no bind any device yet. Please bind a device in Centagate App to use the passwordless transaction.</p>
                           </div>
                        </div>

                     </p:dialog>

                  </h:form>
               </div>
            </div>
         </div>

         <style>
               .card{
                  padding: 1.5em .5em .5em;
                  border-radius: 2em;
                  text-align: center;
                  box-shadow: 0 5px 10px rgba(0,0,0,.2);
               }
           
               li {
                  list-style: none;
               }

               b {
                  font-family: 'Roboto', sans-serif;
                  color: #013763;
               }

               a {
                  text-decoration: none;
               }

               .block {
                  font-weight: bold;
                  font-family: 'Roboto',sans-serif !important;
                  color: #1E3A8A;
               }


               .ui-inputnumber input {
                  text-align: center;
                  border-radius: 21px;
                  width: 50%;
                  height: 50%;
                  padding-top: 10px;
                  padding-bottom: 10px;
               }

               .ui-inputfield {
                  color: #1976D2 !important;
               }

               .submit-button {
                  font-family: 'Roboto', sans-serif;
                  font-size: 18px;
                  font-weight: bold;
                  background-color: #1565C0;
                  border-width: 2px;
                  border-color: #013763;
                  padding-top: 5px;
                  padding-bottom: 5px;
                  width: 100%;
                  height: 100%;
               }

               .transact-image {
                  background-image: url("resources/images/transact.jpg");
                  background-position: center;
                  background-size: cover;
               }

               .ui-dialog-titlebar {
                  text-align: left;
                  background-color: #1565C0 !important;
                  color: #000000 !important;
               }

               .confirmButton {
                  font-family: 'Roboto', sans-serif;
                  font-weight: bold;
                  color:#000000 !important;
                  border-radius: 20px !important;
                  padding: 20, 20 !important;
               }

               .my-button {
                  padding: 24px;
               }

               method {
                  border: 2px solid;
                  border-bottom: 2px;
               }

               .pi.pi-send , .pi.pi-qrcode{
                  color: #FFFFFF !important;
                  font-size: 18px !important;
               }
         </style>

         <h:outputScript>
            function showOption() {
               var bind = document.getElementById("bindAuth").value;
            
               PF('confirmDetails').hide();
               PF('showTransact').show();
               
               if(bind == 0) {
                  document.getElementById("bindauth").style.display = "block";
               }else if(bind == 1) {
                  document.getElementById("nobindnoauth").style.display = "block";
               }else {
                  document.getElementById("bindnoauth").style.display = "block";
               }
            }
         </h:outputScript>
      </h:body>

   </ui:define>
</ui:composition>