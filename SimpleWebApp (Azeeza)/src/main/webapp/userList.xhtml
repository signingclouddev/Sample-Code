<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <style>
      body {
        background-color: #FBEEC1;
      }

      .container {
        position: relative;
      }

      .input-field {
        width: 100%; /* Adjust the width as needed */
      }

      .grid-item {
        //
      }

      .dialog-position {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      .no-border {
        border: none;
        align-items: center;
      }

      footer {
        text-align: center;
      }
    </style>
    <h:outputStylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <h:outputStylesheet href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet" />
    <h:outputScript src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js" />
    <h:outputStylesheet name="primeicons.css" library="primefaces"/>
    <h:outputScript name="primefaces.js" />
    <link rel="icon" href="webapp/images/simple-web-icon-logo.png" type="image/png" />
    <title>User List</title>
</h:head>

<h:body>
    <ui:include src="include/topNavigation.xhtml" />
    <div class="container" style="display:flex;">
        <h:form name="searchForm" var="search" id="searchForm">
            <p:panel id="SearchPanel" header="Search for Specific User by Username" styleClass="no-border">
                <p:panelGrid columns="3">
                    <p:column>
                        <p:outputLabel id="search" for="Search" value="Username :" />
                    </p:column>
                    <p:column>
                        <p:inputText id="Search" value="${displayUser.searchQuery}" />
                    </p:column>
                    <p:column>
                        <p:commandButton id="btn" value="Search" action="${displayUser.find()}" update="searchForm" />
                    </p:column>
                </p:panelGrid>
            </p:panel>
            <p:panel id="DisplayPanel" header="User List">
                <p:dataTable id="table" var="displayData" value="${displayUser.find()}">
                    <p:column headerText="ID" width="20px">
                        <h:outputText value="${displayData.employee_id}" />
                    </p:column>
                    <p:column headerText="Username">
                        <h:outputText value="${displayData.employee_username}" />
                    </p:column>
                    <p:column headerText="First Name">
                        <h:outputText value="${displayData.employee_fname}" />
                    </p:column>
                    <p:column headerText="Last Name">
                        <h:outputText value="${displayData.employee_lname}" />
                    </p:column>
                    <p:column headerText="Email" width="250px">
                        <h:outputText value="${displayData.employee_email}" />
                    </p:column>
                    <p:column headerText="Group">
                        <h:outputText value="${displayData.employee_group}" />
                    </p:column>
                    <p:column headerText="Actions" width="180px">
                        <h:panelGroup>
                            <p:commandButton icon="pi pi-user-edit" value="Edit User Profile" action="#{displayUser.selectedEmployee(displayData.employee_id, displayData.employee_username)}" ajax="true" styleClass="rounded-button ui-button-help" oncomplete="PF('viewDetailsDialog').show()">
                                <f:setPropertyActionListener target="#{displayUser.selectedEmployeeId}" value="#{displayData.employee_id}" />
                                <f:setPropertyActionListener target="#{displayUser.selectedEmployeeUsername}" value="#{displayData.employee_username}" />
                            </p:commandButton>
                            <br></br><br></br>
                            <p:commandButton icon="pi pi-user-minus" value="Remove" action="#{deleteUser.getUnbindAndDeleteUserApi}"
                                             actionListener="#{displayUser.selectedEmployee(displayData.employee_id, displayData.employee_username)}"
                                             ajax="true" styleClass="rounded-button ui-button-danger">
                                <f:setPropertyActionListener target="#{displayUser.selectedEmployeeId}" value="#{displayData.employee_id}" />
                                <f:setPropertyActionListener target="#{displayUser.selectedEmployeeUsername}" value="#{displayData.employee_username}" />
                            </p:commandButton>
                        </h:panelGroup>
                    </p:column>
                </p:dataTable>
            </p:panel>
        </h:form>
    </div>

    <p:dialog header="Employee Details" widgetVar="viewDetailsDialog" modal="true" dynamic="true" closable="true" visible="false" width="500" height="500" styleClass="dialog-position" onHide="redirectToDisplayUserList()">
    <f:event listener="#{updateProfile.displayProfileEmployee}" type="preRenderComponent" />
        <p:accordionPanel multiple="true" widgetVar="multiple">
            <p:tab title="Employee Details" styleClass="tab-title">
                <h:form name="updateProfileForm" var="updateProfile" id="updateProfileForm">
                <h4>Employee Details</h4>
                <div class="grid-container">
                    <div class="grid-item" style="display:none">
                        <h:outputLabel value="Employee ID" /><br></br>
                        <p:inputText id="employeeId" placeholder="Admin ID" value="#{displayUser.selectedEmployeeId}" styleClass="input-field" readonly="true" />
                        <h:message for="employeeId"></h:message>
                        <br></br><br></br>
                    </div>
                    <div class="grid-item" style="display:none">
                        <h:outputLabel value="Admin Username" /><br></br>
                        <p:inputText id="adminUsername" placeholder="Admin Username" value="#{updateProfileAdmin.adminUsername}" styleClass="input-field" readonly="true" />
                        <h:message for="adminUsername"></h:message>
                        <br></br><br></br>
                    </div>
                    <div class="grid-item">
                        <h:outputLabel value="Username" /><br></br>
                        <p:inputText id="employeeUsername" value="#{displayUser.selectedEmployeeUsername}" styleClass="input-field" disabled="true" />
                        <h:message for="employeeUsername"></h:message>
                        <br></br><br></br>
                    </div>
                    <div class="grid-item">
                        <h:outputLabel value="First Name" /><br></br>
                        <p:inputText id="firstName" value="#{updateProfile.firstName}" styleClass="input-field" />
                        <h:message for="firstName"></h:message>
                        <br></br><br></br>
                    </div>
                    <div class="grid-item">
                        <h:outputLabel value="Last Name" /><br></br>
                        <p:inputText id="lastName" value="#{updateProfile.lastName}" styleClass="input-field" />
                        <h:message for="lastName"></h:message>
                        <br></br><br></br>
                    </div>
                    <div class="grid-item">
                        <h:outputLabel value="Email" /><br></br>
                        <p:inputText id="userEmail" value="#{updateProfile.userEmail}" styleClass="input-field" />
                        <h:message for="userEmail"></h:message>
                        <br></br><br></br>
                    </div>
                </div>
                <div class="button-container">
                <p:commandButton class="updateProfileBtn" action="#{updateProfile.getUpdateUserProfileApi}" value="Save" update="updateProfileForm" ajax="true" styleClass="ui-button-primary" style="width:50%;">
                    <p:confirm header="Confirmation" message="Are you sure you want to change your profile details?" icon="pi pi-exclamation-triangle" />
                </p:commandButton>

                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Yes" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="No" action="#{updateProfile.no}" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
                </p:confirmDialog>
                </div>
                </h:form>
            </p:tab>
        </p:accordionPanel>
    </p:dialog>

    <footer>
        <ui:include src="include/footer.xhtml" />
    </footer>

    <script>
    function redirectToDisplayUserList() {
        window.location.href = "userList.xhtml";
    }
    </script>
</h:body>
</html>